<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Recuperar Senha</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script>
        tailwind.config = { darkMode: "class", theme: { extend: { colors: { "primary": "#1173d4", "background-light": "#f5f5f5", "background-dark": "#101922", }, fontFamily: { "display": ["Inter", "sans-serif"] }, borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" }, }, }, }
    </script>
    <style> body { min-height: max(884px, 100dvh); } </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
    <div class="relative flex min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden">
        <div class="flex items-center p-4 pb-2 justify-between">
            <a href="/pagina_de_login.html" class="flex items-center">
                <span class="material-symbols-outlined text-[#333333] dark:text-white" style="font-size: 24px;">arrow_back</span>
            </a>
        </div>
        <main class="flex-1 flex flex-col justify-center px-4 py-8">
            <div id="formContainer" class="w-full max-w-md mx-auto">
                <div class="text-center mb-8">
                    <span class="material-symbols-outlined text-primary" style="font-size: 48px;">lock_reset</span>
                </div>
                <h1 class="text-[#333333] dark:text-white tracking-tight text-[32px] font-bold leading-tight text-center pb-3">Esqueceu sua senha?</h1>
                <p class="text-[#333333] dark:text-gray-300 text-base font-normal leading-normal pb-8 text-center">
                    Sem problemas. Insira seu e-mail de cadastro e enviaremos um link para você criar uma nova senha.
                </p>
                <form id="forgotPasswordForm">
                    <div class="flex max-w-[480px] flex-wrap items-end gap-4 py-3 w-full">
                        <label class="flex flex-col min-w-40 flex-1">
                            <p class="text-[#333333] dark:text-gray-300 text-base font-medium leading-normal pb-2">E-mail</p>
                            <div class="relative">
                                <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">mail</span>
                                <input id="email" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#333333] dark:text-white focus:outline-0 focus:ring-0 border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-gray-800 focus:border-primary dark:focus:border-primary h-14 placeholder:text-[#757575] pl-10 pr-4 p-[15px] text-base font-normal leading-normal" placeholder="seuemail@empresa.com" value="" type="email" />
                            </div>
                        </label>
                    </div>
                </form>
                <div class="flex px-0 py-3 mt-4">
                    <button type="button" id="sendLinkButton" class="flex min-w-[84px] w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 flex-1 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] shadow-md hover:bg-opacity-90 transition-opacity disabled:opacity-50">
                        <span id="buttonText" class="truncate">Enviar Link de Recuperação</span>
                    </button>
                </div>
                <div class="text-center mt-6">
                    <a class="text-sm text-[#757575] dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors" href="/pagina_de_login.html">Lembrou a senha? Voltar para o login</a>
                </div>
            </div>
            
            <div id="successMessage" class="hidden w-full max-w-md mx-auto text-center">
                <div class="flex items-center justify-center w-20 h-20 rounded-full bg-green-500/20 mb-6 mx-auto">
                    <span class="material-symbols-outlined text-5xl text-green-500">mark_email_read</span>
                </div>
                <h1 class="text-[#333333] dark:text-white text-3xl font-bold">Link Enviado!</h1>
                <p class="text-[#333333] dark:text-gray-300 text-lg mt-4">Enviamos um link de recuperação para o seu e-mail. Por favor, verifique sua caixa de entrada.</p>
            </div>
        </main>
    </div>

    <script>
        // CORREÇÃO 2: Espera todo o HTML ser carregado antes de executar o script
        document.addEventListener('DOMContentLoaded', () => {
            const sendLinkButton = document.getElementById('sendLinkButton');
            const emailInput = document.getElementById('email');
            const formContainer = document.getElementById('formContainer');
            const successMessage = document.getElementById('successMessage');
            const buttonText = document.getElementById('buttonText');
            const form = document.getElementById('forgotPasswordForm');

            // Previne o envio do formulário caso o usuário pressione Enter no campo de e-mail
            form.addEventListener('submit', (event) => {
                event.preventDefault();
                sendLinkButton.click(); // Simula o clique no botão para manter o fluxo
            });

            sendLinkButton.addEventListener('click', async () => {
                const email = emailInput.value;
                if (!email) {
                    alert('Por favor, insira seu e-mail.');
                    return;
                }

                sendLinkButton.disabled = true;
                buttonText.textContent = 'Enviando...';

                try {
                    const response = await fetch('/api/auth/forgotpassword', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email })
                    });

                    // A API sempre retorna sucesso, então podemos mostrar a tela de sucesso
                    formContainer.classList.add('hidden');
                    successMessage.classList.remove('hidden');

                } catch (error) {
                    console.error('Erro de rede:', error);
                    alert('Erro de conexão. Tente novamente.');
                    sendLinkButton.disabled = false;
                    buttonText.textContent = 'Enviar Link de Recuperação';
                }
            });
        });
    </script>
</body>
</html>